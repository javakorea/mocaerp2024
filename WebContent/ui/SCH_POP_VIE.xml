<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head meta_programId="BM004P01" meta_programName="메뉴별 프로그램 조회 팝업" meta_programDesc="메뉴별 프로그램 조회 팝업" meta_author="Inswave Systems"
		meta_date="2021.02.25">
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
                <w2:dataList baseNode="list" repeatNode="map" id="dlt_gubunList" saveRemovedData="true">
                    <w2:columnInfo>
                        <w2:column id="CODE" name="CODE" dataType="text" length=""/>
                        <w2:column id="DATA" name="DATA" dataType="text" length=""/>
                    </w2:columnInfo>
                    <w2:data use="true">
                        <w2:row>
                            <CODE><![CDATA[1]]></CODE>
                            <DATA><![CDATA[개인일정]]></DATA>
                        </w2:row>
                        <w2:row>
                            <CODE><![CDATA[2]]></CODE>
                            <DATA><![CDATA[업무일정]]></DATA>
                        </w2:row>
                    </w2:data>
                </w2:dataList>				
				<w2:dataMap baseNode="map" id="dma_content">
					<w2:keyInfo>
						<w2:key id="SCH_IDX" name="SCH_IDX" dataType="text"></w2:key>
						<w2:key id="SCH_TITLE" name="SCH_TITLE" dataType="text"></w2:key>
						<w2:key id="SCH_CONT" name="SCH_CONT" dataType="text"></w2:key>
						<w2:key id="SCH_WRITER" name="SCH_WRITER" dataType="text"></w2:key>

						<w2:key id="SCH_CREATE_DTTM" name="SCH_CREATE_DTTM" dataType="text"></w2:key>
						<w2:key id="SCH_CURRENTMONTH" name="SCH_CURRENTMONTH" dataType="text"></w2:key>
						<w2:key id="SCH_START" name="SCH_START" dataType="text"></w2:key>
						<w2:key id="SCH_END" name="SCH_END" dataType="text"></w2:key>
						<w2:key id="SCH_COLOR" name="SCH_COLOR" dataType="text"></w2:key>
						<w2:key id="SCH_DELYN" name="SCH_DELYN" dataType="text"></w2:key>
						<w2:key id="SCH_SENDYN" name="SCH_SENDYN" dataType="text"></w2:key>
						<w2:key id="STATUS" name="STATUS" dataType="text"></w2:key>
						<w2:key id="SCH_SUCCESSYN" name="SCH_SUCCESSYN" dataType="text"></w2:key>
						
						<!-- 공통부 -->
						<w2:key id="COMMON_STATUS" name="CRUD_상태" dataType="text"></w2:key>
						<w2:key id="COMMON_QUERY" name="SELECT_QUERY" dataType="text"></w2:key>
						<w2:key id="COMMON_MASTER_QUERY" name="COMMON_MASTER_QUERY" dataType="text"></w2:key>
						<w2:key id="COMMON_DETAIL_INSERTQUERY" name="SUBQUERY" dataType="text"></w2:key>
						<w2:key id="COMMON_DETAIL_UPDATEQUERY" name="SUBQUERY" dataType="text"></w2:key>
						<w2:key id="COMMON_DETAIL_DELETEQUERY" name="SUBQUERY" dataType="text"></w2:key>
						<w2:key id="COMMON_MASTER_KEY" name="COMMON_MASTER_KEY" dataType="text"></w2:key>
						<w2:key id="COMMON_DETAIL_KEY" name="COMMON_DETAIL_KEY" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="COMMON_RESULT">
					<w2:keyInfo>
						<w2:key id="COMMON_MASTER_RESULT" name="COMMON_MASTER_RESULT" dataType="text"></w2:key>
						<w2:key id="COMMON_DETAIL_RESULT" name="COMMON_DETAIL_RESULT" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
			<xf:submission id="sbm_commonTran" ref='data:json,[{"id":"dma_content","key":"dma_common_request"}]' target="data:json,COMMON_RESULT"
				action="/commonTran.do" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler=""
				customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_commonTran_submitdone" ev:submiterror=""
				abortTrigger="">
			</xf:submission>
		</xf:model>
		<w2:layoutInfo></w2:layoutInfo>
		<w2:publicInfo method=""></w2:publicInfo>
		<script type="text/javascript" lazy="false"><![CDATA[scwin.onpageload = function () {
	let _parentDma = $p.parent().scwin.selectedSchObj;
	//scwin.param = com.data.getParameter();
	//let _parentDma = $p.parent().dlt_list.getMatchedJSON('SCH_IDX',scwin.param.data.schInfo.SCH_IDX)[0];
	//if(scwin.param.data.mode == "read"){
		dma_content.setJSON(_parentDma);
		scwin.btn_visible();
		edi_1.setValue(dma_content.get('SCH_CONT'));








		$p.parent().btn_adayListReg.setLabel('등록');
		$p.parent().btn_adayListReg.hide();
		
		$p.parent().btn_adayListClose.setLabel('이전목록');
		$p.parent().btn_adayListClose.show('');	

		$p.parent().btn_success.setLabel('완료처리');
		$p.parent().btn_success.show('');

		$p.parent().btn_update.setLabel('수정');
		$p.parent().btn_update.show('');

		$p.parent().btn_del.setLabel('삭제');
		$p.parent().btn_del.show('');


	//}else{
	//	dfbox.show('');
	//	dma_content.set("SCH_COLOR","#076aff");
	//	dma_content.set("SCH_WRITER",scwin.param.data.writer);
	//}
	//dma_content.set("SCH_START",scwin.param.data.schInfo.START);
	//dma_content.set("SCH_END",scwin.param.data.schInfo.END);
};

scwin.btn_visible = function(){
	btn_update.show('');
	btn_del.show('');
	btn_success.removeClass("skyblue");
	if(dma_content.get('SCH_SUCCESSYN') == 'Y'){
		btn_success.setLabel('완료취소');
	}else{
		btn_success.addClass("skyblue");
		btn_success.setLabel('완료처리');
	}
	btn_success.show('');
	btn_adminDel.show('');
	btn_confirm.hide();
	//dfbox.show(''); --2024-4-10
}
/* 일정등록 */
scwin.btn_confirm_onclick = function(e) {
	com.win.confirm($p, '일정을 등록하시겠습니까?', function(e){
		if(e.clickValue){
			dma_content.set("COMMON_MASTER_QUERY"	, "M.insertSchedule");
			dma_content.set("COMMON_STATUS", "I");

			let _current = dma_content.getJSON().SCH_START.substr(0,6);
			
			dma_content.set("SCH_CONT", edi_1.getValue());
			dma_content.set("SCH_TITLE",edi_1.getValue().substring(0,20));
			dma_content.set("SCH_CURRENTMONTH",_current);
			com.sbm.execute(sbm_commonTran);
		}
	});
};

/* 게시물 수정,삭제 callback */
scwin.sbm_commonTran_submitdone = function(e) {
	let _j = e.responseJSON;
	if(_j.status == "S"){
		let request = _j.COMMON_RESULT.COMMON_PARAM_MAP;
		if(request.COMMON_STATUS == "D" || request.SCH_DELYN == "Y"){//물리삭제 또는 논리삭제
			com.win.closePopup({"message":"삭제가 완료되었습니다."});
		}else if(request.COMMON_STATUS == "I"){
			com.win.closePopup({"message":"등록이 완료되었습니다."});
		}else{
			if(!scwin.autoYn ||scwin.autoYn == "N"){
				com.win.closePopup({"message":"수정이 완료되었습니다."});
			}
		}
	}
};	
	
/* 팝업닫기 */
scwin.btn_cancel_onclick = function(e) {
	$p.parent().scwin.popupSchVieClose();
};

/* 일정 논리삭제 */
scwin.btn_del_onclick = function(e) {
    com.win.confirm($p, '해당 게시물을 삭제하시겠습니까?', function(e){
		if(e.clickValue){
			dma_content.set("COMMON_MASTER_QUERY"	, "M.updateSchedule");
			dma_content.set("COMMON_STATUS", "U");dma_content.set("SCH_DELYN","Y");//논리삭제
			com.sbm.execute(sbm_commonTran);
		}
	});
};

/* 일정 물리삭제 */
scwin.btn_adminDel_onclick = function(e) {
	var data = {callbackFn: "scwin.delPop_callback" };
	var options = {
		id: "delPop",
		popupName: "일정삭제",
		modal: true,
		useMaximize : true,
		width: 420, height: 116
	};
	com.win.openPopup("/ui/delPop.xml", options, data);
	scwin.delPop_callback = function(e){
		if(e.delYn){
			com.win.confirm($p, '삭제하시면 데이터를 더이상 복구하실 수 없습니다.\n 해당 게시물을 삭제하시겠습니까?', function(e){
				if(e.clickValue){
					dma_content.set("COMMON_MASTER_QUERY"	, "M.deleteSchedule");
					dma_content.set("COMMON_STATUS", "D");
					com.sbm.execute(sbm_commonTran);
				}
			})
		}
	};	
};






/* 일정 수정 */
scwin.btn_update_onclick = function(e) {
	com.win.confirm($p, '해당 게시물을 수정하시겠습니까?', function(e){
		if(e.clickValue){
			scwin.btn_update_exe();
		}
	});
};

scwin.btn_done_onclick = function(e) {
	let _label = btn_success.getLabel();
	com.win.confirm($p, `${_label} 하시겠습니까?`, function(e){
		if(e.clickValue){
			let _successYn = dma_content.get('SCH_SUCCESSYN');
			if(_successYn == 'Y'){
				dma_content.set("SCH_SUCCESSYN", "N");
			}else{
				dma_content.set("SCH_SUCCESSYN", "Y");
			}
			scwin.btn_update_exe();
		}
	});
};

scwin.btn_update_exe = function(e) {
	dma_content.set("COMMON_MASTER_QUERY"	, "M.updateSchedule");
	dma_content.set("COMMON_STATUS", "U");
	dma_content.set("SCH_CONT", edi_1.getValue());
	let _title =  edi_1.getValue().substring(0,20);
	_title = _title.split('---')[0]+'---'+dma_content.get('SCH_IDX');
	dma_content.set("SCH_TITLE",_title);
	com.sbm.execute(sbm_commonTran);
};




scwin.btn_color_onclick = function(e) {
	var data = {callbackFn: "scwin.colorPop_callback" };
	var options = {
		id: "colorPop",
		className: "fixfix",
		popupName: "색상변경",
		modal: true,
		useMaximize : true,
		width: 420, height: 227
	};
	com.win.openPopup("/ui/colorPop.xml", options, data);
};
scwin.colorPop_callback = function(e){
	if(e.color){
		dma_content.set("SCH_COLOR", e.color);
	}
};

scwin.display = function(_data){
	if(_data){
		let yyyyMMdd = _data.substring(0,10).replace(/-/g,'');
		yyyyMMdd = $p.parent().scwin.getDay(yyyyMMdd);
		return WebSquare.date.getFormattedDate(yyyyMMdd,'yyyy년MM월dd일(EEE)');
	}else{
		return "";
	}
};



scwin.display_color = function(_data){
	let _bgColor = _data;
	_bgColor = $p.parent().scwin.getBgColorTag(_bgColor);
	let j = dlt_gubunList.getMatchedJSON('CODE', _data, true);
	let txt = '';
	if(j && j.length > 0){
		txt = j[0].DATA;
	}
	return `<span class='sch_bar' style='${_bgColor}'>${txt}</span>`;
};]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload">
		<xf:group id="" class="pop_contents flex_gvw flex_m" style="background:#f4f5f9">
			<xf:group id="">
				<xf:group style="display:none;" id="dfbox" class="dfbox">
					<xf:group style="" id="" class="fl">
						<xf:trigger style="display: none;" id="btn_adminDel" type="button" class="btn_cm red"
							ev:onclick="scwin.btn_adminDel_onclick">
							<xf:label><![CDATA[폐기]]></xf:label>
						</xf:trigger>
					</xf:group>
					<xf:group style="" id="grp_btn" class="fr">
						<xf:trigger class="btn_cm" id="btn_success" nextTabID="" style="display:none" type="button"
							ev:onclick="scwin.btn_done_onclick">
							<xf:label><![CDATA[완료처리]]></xf:label>
						</xf:trigger>
						<xf:trigger style="display: none;" id="btn_del" type="button" class="btn_cm" ev:onclick="scwin.btn_del_onclick">
							<xf:label><![CDATA[삭제]]></xf:label>
						</xf:trigger>
						<xf:trigger class="btn_cm" ev:onclick="scwin.btn_confirm_onclick" id="btn_confirm" nextTabID="" style=""
							type="button">
							<xf:label><![CDATA[저장]]></xf:label>
						</xf:trigger>
						<xf:trigger class="btn_cm" id="btn_update" nextTabID="" style="display:none;" type="button"
							ev:onclick="scwin.btn_update_onclick">
							<xf:label><![CDATA[수정]]></xf:label>
						</xf:trigger>
						<xf:trigger class="btn_cm" ev:onclick="scwin.btn_cancel_onclick" id="btn_cancel" style="" type="button">
							<xf:label><![CDATA[닫기]]></xf:label>
						</xf:trigger>
					</xf:group>
				</xf:group>
			</xf:group>
			<xf:group class="tbbox" id="tbl_search" style="border-bottom: 2px solid #333;">
				<xf:group adaptive="layout" adaptiveThreshold="768" class="w2tb tb" id="" style="width:100%;" tagname="table">
					<w2:attributes>
						<w2:summary></w2:summary>
					</w2:attributes>
					<xf:group tagname="colgroup">
						<xf:group tagname="col" style=""></xf:group>
					</xf:group>
					<xf:group style="" tagname="tr" id="tr_read">
						<xf:group tagname="td" class="w2tb_td"
							style="padding: 4px;    border-top: 0 !important;    border-right: 0 !important;    background: none;    margin-bottom: 7px;">
							<w2:attributes></w2:attributes>
							<!-- 							<w2:inputCalendar calendarValueType="yearMonthDateTimeSec" focusOnDateSelect="false" footerDiv="true" id=""
								ref="data:dma_content.SCH_START" renderDiv="true" rightAlign="false" style="width:calc(50% - 5px);width:calc(50% - 2.5px);"
								class="multi" mandatory="true">
								</w2:inputCalendar>
								<w2:inputCalendar calendarValueType="yearMonthDateTimeSec" focusOnDateSelect="false" footerDiv="true" id=""
								ref="data:dma_content.SCH_END" renderDiv="true" rightAlign="false" style="width:calc(50% - 2.5px);margin-right:0;" class="multi" mandatory="true">
								</w2:inputCalendar> -->
							<w2:textbox id="" label="" style="" tagname="span" class="fl sch_spa_view fa fa-calendar-o"></w2:textbox>
							<w2:textbox class="ipt_day" displayFormatter="scwin.display" ref="data:dma_content.SCH_START" id="ipt_day"
								label="" style="" tagname="span">
							</w2:textbox>
						</xf:group>
					</xf:group>
					<xf:group tagname="tr" id="tr_gubunYn" style="">
						<xf:group tagname="td" class="w2tb_td" style="padding: 4px;    border-top: 0 !important;    border-right: 0 !important;    background: none;    margin-bottom: 7px;">
							<w2:attributes></w2:attributes>
							<w2:textbox class="" displayFormatter="scwin.display_color" 
								ref="data:dma_content.SCH_COLOR" id="rdo_gubunYn"
								label="" style="" tagname="span">
							</w2:textbox>
						</xf:group>
					</xf:group>						
					<xf:group tagname="tr" id="tr_createDt" style="display:none;">
						<xf:group tagname="td" class="w2tb_td">
							<w2:attributes></w2:attributes>
							<xf:input class="" id="ibx_schdDate" placeholder="" readOnly="true" ref="data:dma_content.SCH_CREATE_DTTM"
								style="width:100%;">
							</xf:input>
						</xf:group>
					</xf:group>
					<xf:group tagname="tr" style="display:none;" id="tr_writer">
						<xf:group tagname="td" class="w2tb_td">
							<w2:attributes></w2:attributes>
							<xf:input class="" id="ibx_schdWriter" placeholder="" readOnly="true" ref="data:dma_content.SCH_WRITER"
								style="width:100%;">
							</xf:input>
						</xf:group>
					</xf:group>
					<xf:group tagname="tr" style="display:none;" id="tr_title">
						<xf:group tagname="td" class="w2tb_td">
							<w2:attributes></w2:attributes>
							<xf:input class="req" id="ibx_boardTitle" placeholder="" ref="data:dma_content.SCH_TITLE" style="width:100%;"></xf:input>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
			<xf:group id="" class="edbox sch">
				<xf:group id="" style="" class="edi_btn">

				</xf:group>
				<xf:textarea id="edi_1" class="sch_view_cont read" style="height:100%" ref="data:dma_content.SCH_CONT" escape="false"
					readOnly="true">
				</xf:textarea>
			</xf:group>
		</xf:group>
		
	</body>
</html>
